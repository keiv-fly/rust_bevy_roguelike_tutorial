<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Roguelike tutorial with Rust and Bevy</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">Introduction</a></li><li class="chapter-item expanded "><a href="chapter01.html"><strong aria-hidden="true">1.</strong> Setting Up</a></li><li class="chapter-item expanded "><a href="chapter02.html"><strong aria-hidden="true">2.</strong> Draw "@" symbol and moving around</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Roguelike tutorial with Rust and Bevy</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/keiv-fly/rust_bevy_roguelike_tutorial/tree/main/tutorial" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This is a tutorial to create a roguelike game using <a href="https://www.rust-lang.org/">Rust</a> and <a href="https://bevyengine.org/">Bevy</a>.</p>
<p>The tutorial is based on <a href="https://rogueliketutorials.com/tutorials/tcod/v2/">Yet Another Roguelike Tutorial - Written in Python 3 and TCOD</a> and the Bevy Roguelike code available <a href="https://github.com/thephet/BevyRoguelike">here</a> </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="setting-up"><a class="header" href="#setting-up">Setting Up</a></h1>
<h2 id="prior-knowledge"><a class="header" href="#prior-knowledge">Prior knowledge</a></h2>
<p>This tutorial assumes that a reader is familiar with Rust, but of course you can try to read it without knowing Rust.</p>
<h2 id="installing-rust"><a class="header" href="#installing-rust">Installing Rust</a></h2>
<p>In this tutorial I will be installing the latest Rust version and also Rust nightly build for faster development on Windows. The nightly build allows to compile Bevy in a dynamic library once and then reuse it for all the following compilations.</p>
<p><a href="https://www.rust-lang.org/tools/install">Download Rust from here.</a> I recommend using a 64-bit version. For Windows the button has a title &quot;DOWNLOAD RUSTUP-INIT.EXE (64-BIT)&quot;. I used the default settings in the installation.</p>
<h2 id="creating-a-project"><a class="header" href="#creating-a-project">Creating a project</a></h2>
<p>I created a new project by executing the following command:</p>
<pre><code>cargo new bevy_roguelike_tutorial
</code></pre>
<p>and go inside this folder:</p>
<pre><code>cd bevy_roguelike_tutorial
</code></pre>
<p>This created the following folder structure:</p>
<pre><code>bevy_roguelike_tutorial
├── .gitignore
├── Cargo.lock
├── Cargo.toml
├── src
│   └── main.rs
└── target
    └── ...
</code></pre>
<p>With the main code in <code>src/main.rs</code></p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    println!(&quot;Hello, world!&quot;);
}
</code></pre></pre>
<p>Let's compile the code and see that this Rust program is working.</p>
<p>In the command line execute:</p>
<pre><code>cargo run
</code></pre>
<p>And you should have the following output:</p>
<pre><code>   Compiling bevy_roguelike_tutorial v0.1.0 (C:\...\bevy_roguelike_tutorial)
    Finished dev [unoptimized + debuginfo] target(s) in 0.33s
     Running `target\debug\bevy_roguelike_tutorial.exe`
Hello, world!
</code></pre>
<h2 id="install-bevy"><a class="header" href="#install-bevy">Install Bevy</a></h2>
<p>Here I am setting setting up to use Rust nightly build and use Bevy as a dynamic library.</p>
<p>To install Rust nightly build execute the following command:</p>
<pre><code>rustup install nightly
</code></pre>
<p>Create a new file <code>bevy_roguelike_tutorial/rust-toolchain</code> with the following content:</p>
<pre><code>nightly
</code></pre>
<p>This step is specifically for Windows users. On Linux the build should work without it:</p>
<p>Create a directory <code>bevy_roguelike_tutorial/.cargo</code> and put a file with name <code>config.toml</code> with the following content:</p>
<pre><code>[target.x86_64-pc-windows-msvc]
linker = &quot;rust-lld.exe&quot;
rustflags = [&quot;-Zshare-generics=off&quot;]
</code></pre>
<p>A new line should be added to <code>Cargo.toml</code> after <code>[dependencies]</code>:</p>
<pre><code>[dependencies]
bevy = { version = &quot;0.7.0&quot;, features = [&quot;dynamic&quot;] }
</code></pre>
<p>After that run</p>
<pre><code>cargo run
</code></pre>
<p>After several minutes of compiling you should see the following output:</p>
<pre><code>    Finished dev [unoptimized + debuginfo] target(s) in 4m 14s
     Running `target\debug\bevy_roguelike_tutorial.exe`
Hello, world!
</code></pre>
<p>Everything is compiled and Bevy is added. Goal achieved!</p>
<p>The final code could be found here:
<a href="https://github.com/keiv-fly/rust_bevy_roguelike_tutorial/tree/main/code/chapter01">Chapter 01 code</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="draw--symbol-and-moving-around"><a class="header" href="#draw--symbol-and-moving-around">Draw &quot;@&quot; symbol and moving around</a></h1>
<h2 id="showing-an-empty-black-window-with-bevy"><a class="header" href="#showing-an-empty-black-window-with-bevy">Showing an empty black window with Bevy</a></h2>
<p>Let's change the code in <code>main.rs</code> to the following:</p>
<pre><code class="language-rust  noplayground">use bevy::prelude::{App, ClearColor, Color, DefaultPlugins, WindowDescriptor};

fn main() {
    App::new()
        .insert_resource(WindowDescriptor {
            title: &quot;Roguelike Game&quot;.to_string(),
            width: 80.0 * 10.0,
            height: 50.0 * 10.0,
            ..Default::default()
        })
        .insert_resource(ClearColor(Color::rgb(0.1, 0.1, 0.1)))
        .add_plugins(DefaultPlugins)
        .run();
}
</code></pre>
<p>And we get the following window:</p>
<p><img src="img/Roguelike02-01.png" alt="Roguelike02-01" /></p>
<p>This part: </p>
<pre><code class="language-rust  noplayground">        .insert_resource(WindowDescriptor {
            title: &quot;Roguelike Game&quot;.to_string(),
            width: 80.0 * 22.0,
            height: 50.0 * 36.0,
            ..Default::default()
        })
</code></pre>
<p>is responsible for the creation of the window. 10 is the number of pixels in our font. 80 and 50 are the number of columns and lines we will have in our window.</p>
<p>This line is responsible for almost black color of the background:</p>
<pre><code class="language-rust  noplayground">        .insert_resource(ClearColor(Color::rgb(0.1, 0.1, 0.1)))
</code></pre>
<p>And this part:</p>
<pre><code class="language-rust  noplayground">        .add_plugins(DefaultPlugins)
</code></pre>
<p>adds default plugins of Bevy to the game engine.</p>
<h2 id="adding-png-font-to-resources"><a class="header" href="#adding-png-font-to-resources">Adding PNG font to resources</a></h2>
<p>In this tutorial I used the font <code>DejaVu Sans Mono</code>. I found a PNG file of this font <a href="https://allfont.ru/download/dejavu-sans-mono/">here</a>. Then edited it a bit and got the PNG that I liked. You can download the font from <code>code/chapter02/assets/DejaVu Sans Mono22.png</code> in the repository of this tutorial.</p>
<p>To load the PNG font I added the following code to <code>main.rs</code>:</p>
<pre><code class="language-rust  noplayground">fn setup(
    mut commands: Commands,
    asset_server: Res&lt;AssetServer&gt;,
    mut texture_atlases: ResMut&lt;Assets&lt;TextureAtlas&gt;&gt;,
) {
    // Setup the sprite sheet
    let texture_handle = asset_server.load(&quot;DejaVu Sans Mono22.png&quot;);
    let texture_atlas = TextureAtlas::from_grid(texture_handle, Vec2::new(22.0, 36.0), 31, 7);
    let texture_atlas_handle = texture_atlases.add(texture_atlas);
}
</code></pre>
<p>I also added the following line:</p>
<pre><code class="language-rust  noplayground">        .add_startup_system(setup)
</code></pre>
<p>to the <code>main</code> function:</p>
<pre><code class="language-rust  noplayground">fn main() {
    App::new()
        .insert_resource(WindowDescriptor {
            title: &quot;Roguelike Game&quot;.to_string(),
            width: 80.0 * 22.0,
            height: 30.0 * 36.0,
            ..Default::default()
        })
        .insert_resource(ClearColor(Color::rgb(0.1, 0.1, 0.1)))
        .add_startup_system(setup)
        .add_plugins(DefaultPlugins)
        .run();
}
</code></pre>
<p>The code is running, but nothing has changed because nothing yes uses the texture atlas.</p>
<h2 id="drawing-the--symbol"><a class="header" href="#drawing-the--symbol">Drawing the <code>@</code> symbol</a></h2>
<p>Let's create the player Entity and assign the <code>@</code> symbol:</p>
<p>First we need to define the player component:</p>
<pre><code class="language-rust  noplayground">#[derive(Component)]
pub struct Player;
</code></pre>
<p>Then we should add the camera and the creation of the player to the <code>setup()</code> function:</p>
<pre><code class="language-rust  noplayground">    // Add a 2D Camera
    commands.spawn_bundle(OrthographicCameraBundle::new_2d());


    // Spawn the player
    commands
        .spawn()
        .insert(Player)
        .insert_bundle(SpriteSheetBundle {
            texture_atlas: texture_atlas_handle,
            transform: Transform::from_translation(Vec3::new(0., 0., 0.)),
            sprite: TextureAtlasSprite::new(94),
            ..Default::default()
        });
</code></pre>
<p>We need the camera to render our sprites.</p>
<p>The player entity is created with the <code>spawn()</code> command and then we add components to this entity. To identify that this is a player we add the <code>Player</code> component. To add a sprite we add a <code>SpriteSheetBundle</code>. </p>
<ul>
<li><code>texture_atlas</code> is the atlas with our font that will be used. </li>
<li><code>transform</code> is the position of the sprite. 0,0,0 means that it is in the center of the screen.</li>
<li><code>sprite</code> is the sprite that we use from the sprite sheet. Number 94 is the position of the sprite in the sprite sheet (3 lines each have 31 symbols totaling 93 symbols. We start counting at 0 so 92 is the last symbol in line 3 and 93 is the first symbol in line 4. We need the second symbol so the number should be 94)</li>
</ul>
<p>And after <code>cargo run</code> we get the following picture:
<img src="img/Roguelike02-02.png" alt="Roguelike02-02" /></p>
<p>The final code could be found here:
<a href="https://github.com/keiv-fly/rust_bevy_roguelike_tutorial/tree/main/code/chapter02">Chapter02 code</a></p>
<p>The final code of <code>main.rs</code> looks like this:</p>
<pre><code class="language-rust  noplayground">use bevy::prelude::{
    App, AssetServer, Assets, ClearColor, Color, Commands, Component, DefaultPlugins, Handle,
    OrthographicCameraBundle, Res, ResMut, SpriteSheetBundle, TextureAtlas, TextureAtlasSprite,
    Transform, Vec2, Vec3, WindowDescriptor,
};

#[derive(Component)]
pub struct Player;

fn setup(
    mut commands: Commands,
    asset_server: Res&lt;AssetServer&gt;,
    mut texture_atlases: ResMut&lt;Assets&lt;TextureAtlas&gt;&gt;,
) {
    // Setup the sprite sheet
    let texture_handle = asset_server.load(&quot;DejaVu Sans Mono22.png&quot;);
    let texture_atlas = TextureAtlas::from_grid(texture_handle, Vec2::new(22., 36.), 31, 7);
    let texture_atlas_handle = texture_atlases.add(texture_atlas);

    // Add a 2D Camera
    commands.spawn_bundle(OrthographicCameraBundle::new_2d());

    // Spawn the player
    commands
        .spawn()
        .insert(Player)
        .insert_bundle(SpriteSheetBundle {
            texture_atlas: texture_atlas_handle,
            transform: Transform::from_translation(Vec3::new(0., 0., 0.)),
            sprite: TextureAtlasSprite::new(94),
            ..Default::default()
        });
}

fn main() {
    App::new()
        .insert_resource(WindowDescriptor {
            title: &quot;Roguelike Game&quot;.to_string(),
            width: 80.0 * 22.0,
            height: 30.0 * 36.0,
            ..Default::default()
        })
        .insert_resource(ClearColor(Color::rgb(0.1, 0.1, 0.1)))
        .add_plugins(DefaultPlugins)
        .add_startup_system(setup)
        .run();
}
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

        <script type="text/javascript">
        window.addEventListener('load', function() {
            MathJax.Hub.Register.StartupHook('End', function() {
                window.setTimeout(window.print, 100);
            });
        });
        </script>

    </body>
</html>
